# pingcap小作业

------

## 一.题目：
有一个 100GB 的文件，里面内容是文本，找出文件中的第一个不重复的词
要求：
> * 找出第一个不重复的词
> * 只允许扫一遍原文件
> * 尽量少的 IO
> * 内存限制 16G

## 二.解题思路
通过Map/reduce的方式，使用有限内存对文件进行分解。
使用单协程扫描原始文件，对文件内容进行hash分解，下发到数据队列中，下游由固定的goroutine消费，保证相同的字符串分发到固定的goutine中。下游消费者通过定时+threshold的方式对数据进行落盘，用来满足内存<文件大小的要求，并且尽可能减少io操作。
文件分割可能存在hash不均匀，因此通过策略模式提供了两种hash策略，通过轮次设定不同的hash策略进行数据分发。当两次hash后仍然存在严重不均匀，则认为是出现了大量重复数据，通过mem去重减少数据量。
分割阶段如果仍有过大文件，则认为分割失败，程序退出。
当分割后的文件大小满足要求后，对小文件逐个加载进行分析，查找出现频次
为1且出现pos位最小的字符串。

## 三.代码路径
| 文件        | 说明   |
| --------   | -----:  |
| main.go     | 程序入口，调用map/reduce |
| mapper/mapper.go        |   读取文件，并进行数据分发，管理协程序池、分割逻辑   |
| mapper/strategy.go        |   具体的分发策略   |
| mapper/processor.go        |  下游处理协程，完成数据落盘    |
| reducer/reduce.go        |    逐个处理小文件，加载内存中进行计算    |


------


作者 [coder.bihao@foxmail.com]   
2019 年 08月 13日    
